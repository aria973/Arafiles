<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />

  <!-- مهم: فقط یک viewport -->
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <!-- iOS Web App -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <meta name="theme-color" content="#0F172A" />

  <title>Arafiles</title>

  <!-- Icons -->
  <link rel="apple-touch-icon" href="./icon-512.png">
  <link rel="icon" type="image/png" href="./favicon.png" />

  <!-- Manifest -->
  <link rel="manifest" href="./manifest.json" />

  <!-- Styles -->
  <link rel="stylesheet" href="./style.css" />

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.2/cropper.min.js"></script>
</head>

<body class="dark">
  <!-- Header -->
  <header class="app-header glass-3d">
    <h1 class="logo">Arafiles</h1>

    <div class="header-actions">
      <button id="backBtn" class="icon-btn" title="بازگشت" aria-label="بازگشت">
        <span class="material-icons-outlined">arrow_back</span>
      </button>

      <button id="settingsBtn" class="icon-btn" title="تنظیمات" aria-label="تنظیمات">
        <span class="material-icons-outlined">settings</span>
      </button>

      <button class="icon-btn" id="btnSave" title="خروجی JSON" aria-label="خروجی JSON">
        <span class="material-icons-outlined">save</span>
      </button>

      <!-- Import (یک‌بار فقط) -->
      <input type="file" id="importFile" accept=".json,.zip,application/json,application/zip" hidden />
    </div>
  </header>

  <!-- Main -->
  <main id="app" class="container"></main>

  <!-- Floating add folder -->
  <button id="floatingAdd" class="floating-btn" title="افزودن پوشه" aria-label="افزودن پوشه">
    <span class="material-icons-outlined">add</span>
  </button>

  <!-- Settings Modal -->
  <div id="settingsOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-panel glass-3d">
      <div class="modal-header">
        <h2>تنظیمات</h2>
        <button class="icon-btn" id="closeSettingsBtn" aria-label="بستن">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>

      <div class="modal-body">
        <div class="row">
          <label>حالت نمایش</label>
          <div class="row-inline">
            <button class="icon-btn" data-theme="dark" title="شب">
              <span class="material-icons-outlined">dark_mode</span>
            </button>
            <button class="icon-btn" data-theme="light" title="روز">
              <span class="material-icons-outlined">light_mode</span>
            </button>
          </div>
        </div>

        <div class="row">
          <label>پس‌زمینه</label>
          <div class="preview-row" id="bgTiles">
            <div class="preview-tile" data-bg="gradient1" style="background: linear-gradient(120deg,#1f2937,#3b82f6);" title="گرادیانت ۱"></div>
            <div class="preview-tile" data-bg="gradient2" style="background: linear-gradient(120deg,#0ea5e9,#10b981);" title="گرادیانت ۲"></div>
            <div class="preview-tile" data-bg="glass" style="background: rgba(255,255,255,0.5); backdrop-filter: blur(8px);" title="گلس"></div>
            <div class="preview-tile" data-bg="grid" style="background-image: radial-gradient(#64748b 1px, transparent 1px); background-size: 24px 24px;" title="شبکه"></div>
            <div class="preview-tile" data-bg="plain" style="background:#E9EEF5;" title="ساده"></div>
          </div>
        </div>

        <hr/>

        <div class="row">
          <button class="primary" id="importBtn">
            <span class="material-icons-outlined">upload</span> بارگذاری داده‌ها
          </button>
        </div>

        <div class="row">
          <label>ارتباط با ما</label>
          <button class="icon-btn" id="emailBtn" title="ارسال ایمیل">
            <span class="material-icons-outlined">email</span>
          </button>
        </div>

        <hr/>

        <div class="row">
          <label>ریست کامل اپلیکیشن</label>
          <button class="danger" id="resetBtn">
            <span class="material-icons-outlined">delete_forever</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Reset confirm -->
  <div id="resetOverlay" class="modal-overlay" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-panel glass-3d">
      <div class="modal-header">
        <h2>تأیید ریست</h2>
        <button class="icon-btn" id="closeResetBtn" aria-label="بستن">
          <span class="material-icons-outlined">close</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="resetStep1">
          <p>مطمئنی می‌خوای پاک بشه؟</p>
          <div class="row-inline">
            <button class="secondary" id="resetNo1">نه پشیمونم</button>
            <button class="danger" id="resetYes1">بله مطمئنم</button>
          </div>
        </div>
        <div id="resetStep2" class="hidden">
          <p>واقعاً مطمئنی می‌خوای این کارو بکنی؟</p>
          <div class="row-inline">
            <button class="secondary" id="resetNo2">به جون مادرم دستم خورده</button>
            <button class="danger" id="resetYes2">آره بخدا</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- App -->
  <script src="./app.js"></script>

  <!-- iOS zoom/gesture guard -->
  <script>
    // جلوگیری از pinch zoom تا حد ممکن (iOS گاهی سرسخت است)
    document.addEventListener('gesturestart', e => e.preventDefault(), { passive: false });
    document.addEventListener('gesturechange', e => e.preventDefault(), { passive: false });
    document.addEventListener('gestureend', e => e.preventDefault(), { passive: false });

    // جلوگیری از double-tap zoom روی دکمه‌ها
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (e) {
      const now = Date.now();
      if (now - lastTouchEnd <= 300) e.preventDefault();
      lastTouchEnd = now;
    }, { passive: false });
  </script>
</body>
</html>